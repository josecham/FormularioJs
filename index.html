<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Blox Universe Gold</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@700&display=swap');
        body { font-family: 'Fredoka', sans-serif; background: #00A2FF; margin: 0; overflow: hidden; touch-action: none; }
        
        /* Escena 3D */
        .world { perspective: 1000px; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; }
        .floor { 
            width: 4000px; height: 4000px; background-color: #7cfc00;
            background-image: repeating-linear-gradient(0deg, transparent, transparent 39px, rgba(0,0,0,0.1) 40px),
                              repeating-linear-gradient(90deg, transparent, transparent 39px, rgba(0,0,0,0.1) 40px);
            transform: rotateX(60deg); position: absolute;
        }

        /* Personaje con Salto */
        .player-container { position: absolute; width: 50px; height: 80px; transform-style: preserve-3d; transition: bottom 0.2s; z-index: 20; }
        .cube-player { width: 100%; height: 100%; transform-style: preserve-3d; }
        .side { position: absolute; width: 100%; height: 100%; border: 2px solid rgba(0,0,0,0.1); background: #FFD966; }
        .front { transform: translateZ(25px); }
        .top { height: 50px; transform: rotateX(90deg) translateZ(25px); }

        /* Casa */
        .house-box { position: absolute; width: 200px; height: 150px; background: #e74c3c; transform: translate3d(300px, -300px, 0); transform-style: preserve-3d; border: 4px solid #c0392b; }
        .door-yellow { position: absolute; bottom: 0; left: 70px; width: 60px; height: 80px; background: #f1c40f; border: 4px solid #d4ac0d; }

        /* Controles */
        .joy-base { width: 120px; height: 120px; background: rgba(255,255,255,0.2); border-radius: 50%; position: relative; border: 3px solid rgba(255,255,255,0.4); }
        .joy-stick { width: 50px; height: 50px; background: white; border-radius: 50%; position: absolute; top: 35px; left: 35px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .jump-btn { width: 80px; height: 80px; background: rgba(255,255,255,0.4); border-radius: 50%; border: 4px solid white; display: flex; align-items: center; justify-content: center; font-size: 30px; color: white; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [view, setView] = useState('world'); 
            const [coins, setCoins] = useState(150); 
            const [pos, setPos] = useState({ x: 0, y: 0 });
            const [isJumping, setIsJumping] = useState(false);
            const [hasHouse, setHasHouse] = useState(false);
            const [isNearHouse, setIsNearHouse] = useState(false);
            const [placedItems, setPlacedItems] = useState([]);
            
            const joyData = useRef({ x: 0, y: 0, active: false });
            const coinPos = useRef({ x: 100, y: -100 });

            // Ciclo de juego
            useEffect(() => {
                const gameLoop = () => {
                    if (joyData.current.active && view === 'world') {
                        setPos(prev => {
                            const nX = prev.x - joyData.current.x * 10;
                            const nY = prev.y - joyData.current.y * 10;

                            // Colisi√≥n Moneda
                            const dCoin = Math.sqrt(Math.pow(nX + coinPos.current.x, 2) + Math.pow(nY + coinPos.current.y, 2));
                            if (dCoin < 60) {
                                setCoins(c => c + 20);
                                coinPos.current = { x: Math.random() * 800 - 400, y: Math.random() * 800 - 400 };
                            }

                            // Cerca de la casa
                            const dHouse = Math.sqrt(Math.pow(nX + 300, 2) + Math.pow(nY - 300, 2));
                            setIsNearHouse(hasHouse && dHouse < 150);

                            return { x: nX, y: nY };
                        });
                    }
                    requestAnimationFrame(gameLoop);
                };
                requestAnimationFrame(gameLoop);
            }, [view, hasHouse]);

            const jump = () => {
                if (!isJumping) {
                    setIsJumping(true);
                    setTimeout(() => setIsJumping(false), 400);
                }
            };

            const handleJoy = (e) => {
                const rect = document.getElementById('joy-ui').getBoundingClientRect();
                const touch = e.touches ? e.touches[0] : e;
                const centerX = rect.left + 60;
                const centerY = rect.top + 60;
                const dist = Math.min(50, Math.sqrt(Math.pow(touch.clientX - centerX, 2) + Math.pow(touch.clientY - centerY, 2)));
                const angle = Math.atan2(touch.clientY - centerY, touch.clientX - centerX);
                joyData.current.x = (Math.cos(angle) * dist) / 50;
                joyData.current.y = (Math.sin(angle) * dist) / 50;
            };

            return (
                <div className="h-screen w-full relative overflow-hidden bg-sky-400">
                    
                    {view === 'world' ? (
                        <div className="world">
                            {/* Suelo */}
                            <div className="floor" style={{ transform: `rotateX(60deg) translate3d(${pos.x}px, ${pos.y}px, 0)` }}>
                                <div className="absolute w-12 h-12 bg-yellow-400 rounded-full border-4 border-white flex items-center justify-center text-xl shadow-lg" 
                                     style={{ left: 2000 + coinPos.current.x, top: 2000 + coinPos.current.y }}>‚≠ê</div>
                                
                                {hasHouse && (
                                    <div className="house-box" style={{ left: 1900, top: 1800 }}>
                                        <div className="door-yellow"></div>
                                        <div className="absolute -top-12 w-full text-center text-white text-xl">CASA DE {coins > 500 ? 'PRO' : 'NOOB'}</div>
                                    </div>
                                )}
                            </div>

                            {/* Jugador con Salto */}
                            <div className="player-container" style={{ bottom: isJumping ? '55%' : '45%', transform: `rotateY(${joyData.current.x * 40}deg)` }}>
                                <div className="cube-player">
                                    <div className="side front flex flex-col items-center justify-center">
                                        <div className="flex gap-4 mb-2"><div className="w-2 h-2 bg-black rounded-full"></div><div className="w-2 h-2 bg-black rounded-full"></div></div>
                                        <div className="w-6 h-2 bg-black rounded-full"></div>
                                    </div>
                                    <div className="side top"></div>
                                </div>
                            </div>

                            {/* Bot√≥n Entrar */}
                            {isNearHouse && (
                                <button className="absolute top-1/2 bg-yellow-400 p-6 rounded-full font-bold text-2xl border-4 border-white shadow-2xl animate-pulse z-50 pointer-events-auto"
                                        onClick={() => setView('house')}>ENTRAR A CASA üè†</button>
                            )}

                            {/* Controles de Juego */}
                            <div className="absolute bottom-10 w-full px-10 flex justify-between items-center pointer-events-none">
                                <div id="joy-ui" className="joy-base pointer-events-auto"
                                     onTouchStart={() => joyData.current.active = true}
                                     onTouchMove={handleJoy}
                                     onTouchEnd={() => {joyData.current.active = false; joyData.current.x = 0; joyData.current.y = 0;}}>
                                    <div className="joy-stick" style={{ transform: `translate(${joyData.current.x * 35}px, ${joyData.current.y * 35}px)` }}></div>
                                </div>
                                <div className="jump-btn pointer-events-auto active:scale-90 transition-transform" onClick={jump}>‚¨ÜÔ∏è</div>
                            </div>
                        </div>
                    ) : (
                        /* VISTA INTERIOR */
                        <div className="flex flex-col items-center gap-6 p-4 w-full h-full">
                            <h2 className="text-white text-4xl mt-10">INTERIOR üè†</h2>
                            <div className="w-full h-3/5 bg-orange-100 border-8 border-orange-900 rounded-[50px] relative overflow-hidden shadow-inner">
                                {placedItems.map(it => <div key={it.id} className="absolute text-6xl" style={{left: it.x, top: it.y}}>{it.emoji}</div>)}
                            </div>
                            <div className="flex gap-4 overflow-x-auto w-full p-2 bg-black/20 rounded-xl">
                                <button onClick={() => {if(coins>=30){setCoins(coins-30); setPlacedItems([...placedItems,{id:Date.now(),emoji:'üõãÔ∏è',x:100,y:100}])}}} className="bg-white p-4 rounded-xl min-w-[100px]">Sill√≥n $30</button>
                                <button onClick={() => {if(coins>=60){setCoins(coins-60); setPlacedItems([...placedItems,{id:Date.now(),emoji:'üì∫',x:150,y:150}])}}} className="bg-white p-4 rounded-xl min-w-[100px]">Tele $60</button>
                            </div>
                            <button className="bg-red-500 text-white px-12 py-4 rounded-full font-bold text-2xl" onClick={() => {setView('world'); setPos({x:0,y:0});}}>SALIR</button>
                        </div>
                    )}

                    {/* UI TOP */}
                    <div className="absolute top-6 left-6 flex flex-col gap-4 pointer-events-auto">
                        <div className="bg-yellow-400 border-4 border-white px-6 py-2 rounded-full text-white text-2xl shadow-xl flex items-center gap-2">üí∞ {coins}</div>
                        {!hasHouse && view === 'world' && (
                            <button className="bg-red-500 text-white p-4 rounded-2xl font-bold border-b-4 border-red-800" onClick={() => {if(coins>=100){setCoins(coins-100); setHasHouse(true)}}}>COMPRAR CASA $100</button>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
