<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Roblox Super Run</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@700&display=swap');
        body { font-family: 'Fredoka', sans-serif; background: #00A2FF; margin: 0; overflow: hidden; touch-action: none; }
        
        .noob {
            width: 45px; height: 55px;
            position: absolute;
            transition: transform 0.1s linear;
            z-index: 10;
        }
        .noob-head { width: 25px; height: 25px; background: #FFD966; border-radius: 5px; margin: 0 auto; border: 2px solid #E69138; }
        .noob-body { width: 40px; height: 30px; background: #3D85C6; border-radius: 4px; margin: -2px auto; border: 2px solid #0B5394; }

        .coin {
            width: 35px; height: 35px;
            background: #F1C232;
            border: 4px solid #BF9000;
            border-radius: 50%;
            position: absolute;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold;
            animation: bounce 0.8s infinite alternate;
        }

        .powerup {
            width: 35px; height: 35px;
            background: #E74C3C;
            border: 4px solid #C0392B;
            border-radius: 10px;
            position: absolute;
            display: flex; align-items: center; justify-content: center;
            animation: pulse 0.5s infinite;
        }

        @keyframes bounce { from { transform: scale(1); } to { transform: scale(1.2); } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0px rgba(231, 76, 60, 0.7); } 100% { box-shadow: 0 0 0 20px rgba(231, 76, 60, 0); } }

        .joystick-area {
            position: absolute; bottom: 50px; left: 50px;
            width: 130px; height: 130px;
            background: rgba(255,255,255,0.25);
            border: 4px solid rgba(255,255,255,0.4);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
        }

        .btn-roblox {
            background: #2ECC71;
            border-bottom: 8px solid #27AE60;
            color: white; padding: 20px 60px;
            border-radius: 25px; font-size: 35px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [view, setView] = useState('menu');
            const [score, setScore] = useState(0);
            const [timeLeft, setTimeLeft] = useState(30);
            const [speed, setSpeed] = useState(6);
            const [pos, setPos] = useState({ x: 150, y: 300 });
            const [items, setItems] = useState({ coin: {x: 100, y: 100}, power: {x: -100, y: -100} });
            
            const joystick = useRef({ x: 0, y: 0, active: false });
            const gameRunning = useRef(false);

            const startGame = () => {
                setScore(0);
                setTimeLeft(30);
                setSpeed(6);
                gameRunning.current = true;
                setView('game');
                spawnItem('coin');
                if (Math.random() > 0.5) spawnItem('power');
            };

            const spawnItem = (type) => {
                const newPos = {
                    x: Math.random() * (window.innerWidth - 60) + 30,
                    y: Math.random() * (window.innerHeight - 250) + 100
                };
                setItems(prev => ({ ...prev, [type]: newPos }));
            };

            useEffect(() => {
                if (!gameRunning.current) return;

                const interval = setInterval(() => {
                    setTimeLeft(prev => {
                        if (prev <= 1) {
                            gameRunning.current = false;
                            setView('menu');
                            return 0;
                        }
                        return prev - 1;
                    });
                }, 1000);

                const loop = () => {
                    if (joystick.current.active) {
                        setPos(prev => {
                            const nX = prev.x + joystick.current.x * speed;
                            const nY = prev.y + joystick.current.y * speed;

                            // Colisión Moneda
                            if (Math.abs(nX - items.coin.x) < 40 && Math.abs(nY - items.coin.y) < 40) {
                                setScore(s => s + 1);
                                spawnItem('coin');
                            }

                            // Colisión Powerup
                            if (Math.abs(nX - items.power.x) < 40 && Math.abs(nY - items.power.y) < 40) {
                                setSpeed(12);
                                setItems(p => ({...p, power: {x: -100, y: -100}}));
                                setTimeout(() => setSpeed(6), 5000);
                                setTimeout(() => spawnItem('power'), 8000);
                            }

                            return {
                                x: Math.max(0, Math.min(window.innerWidth - 45, nX)),
                                y: Math.max(80, Math.min(window.innerHeight - 150, nY))
                            };
                        });
                    }
                    if (gameRunning.current) requestAnimationFrame(loop);
                };

                requestAnimationFrame(loop);
                return () => clearInterval(interval);
            }, [view, items, speed]);

            const handleStart = () => joystick.current.active = true;
            const handleEnd = () => { joystick.current.active = false; joystick.current.x = 0; joystick.current.y = 0; };
            const handleMove = (e) => {
                if (!joystick.current.active) return;
                const touch = e.touches ? e.touches[0] : e;
                const area = document.getElementById('joy').getBoundingClientRect();
                const cX = area.left + 65;
                const cY = area.top + 65;
                const dist = Math.min(65, Math.sqrt(Math.pow(touch.clientX - cX, 2) + Math.pow(touch.clientY - cY, 2)));
                const angle = Math.atan2(touch.clientY - cY, touch.clientX - cX);
                joystick.current.x = (Math.cos(angle) * dist) / 65;
                joystick.current.y = (Math.sin(angle) * dist) / 65;
            };

            if (view === 'menu') {
                return (
                    <div className="h-screen flex flex-col items-center justify-center p-6 text-center">
                        <h1 className="text-white text-5xl mb-4 italic drop-shadow-lg uppercase">Super Blox Run</h1>
                        {score > 0 && <p className="text-yellow-300 text-2xl mb-8">¡Puntaje anterior: {score}!</p>}
                        <button className="btn-roblox" onClick={startGame}>¡JUGAR!</button>
                        <p className="text-white/60 mt-10 text-sm">Usa el joystick para atrapar estrellas</p>
                    </div>
                );
            }

            return (
                <div className="h-screen w-full relative bg-[#82D677]" onMouseMove={handleMove} onTouchMove={handleMove} onMouseUp={handleEnd} onTouchEnd={handleEnd}>
                    <div className="flex justify-between p-6 bg-black/20 text-white text-2xl">
                        <div className="bg-yellow-500 px-4 rounded-full border-2 border-white">⭐ {score}</div>
                        <div className="bg-red-500 px-4 rounded-full border-2 border-white">⏰ {timeLeft}s</div>
                    </div>

                    <div className="coin shadow-lg" style={{ left: items.coin.x, top: items.coin.y }}>⭐</div>
                    
                    <div className="powerup shadow-lg" style={{ left: items.power.x, top: items.power.y }}>⚡</div>

                    <div className="noob" style={{ left: pos.x, top: pos.y }}>
                        <div className="noob-head"></div>
                        <div className="noob-body"></div>
                    </div>

                    <div id="joy" className="joystick-area" onMouseDown={handleStart} onTouchStart={handleStart}>
                        <div className="w-14 h-14 bg-white rounded-full shadow-lg" style={{ 
                            transform: `translate(${joystick.current.x * 40}px, ${joystick.current.y * 40}px)` 
                        }}></div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
