<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Futuristic VR Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; touch-action: none; }
        
        /* Contenedor VR: Pantalla Dividida */
        .vr-container {
            display: flex;
            width: 100vw; height: 100vh;
        }
        
        .eye {
            flex: 1; height: 100%;
            overflow: hidden;
            position: relative;
            perspective: 800px; /* Sensación de profundidad */
            border-right: 1px solid rgba(255,255,255,0.1);
        }

        /* El Espacio 3D */
        .scene {
            position: absolute; width: 100%; height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.05s linear;
        }

        /* Edificios Futuristas */
        .building {
            position: absolute;
            background: linear-gradient(to top, #1a1a2e, #16213e, #0f3460);
            border: 1px solid #00d2ff;
            box-shadow: 0 0 20px #00d2ff55;
            transform-style: preserve-3d;
        }

        .neon-line {
            position: absolute; background: #e94560;
            box-shadow: 0 0 10px #e94560;
        }

        .star {
            position: absolute; width: 2px; height: 2px; background: white; border-radius: 50%;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [active, setActive] = useState(false);
            const [rotation, setRotation] = useState({ alpha: 0, beta: 0, gamma: 0 });
            const [travel, setTravel] = useState(0);
            
            // Generamos edificios aleatorios una sola vez
            const buildings = useRef([...Array(40)].map((_, i) => ({
                id: i,
                x: Math.random() * 2000 - 1000,
                z: Math.random() * -3000,
                w: 50 + Math.random() * 100,
                h: 200 + Math.random() * 500,
                color: i % 2 === 0 ? '#00d2ff' : '#e94560'
            })));

            const handleMotion = (e) => {
                // Alpha: Rotación sobre el eje Z (giro de cabeza)
                // Beta: Inclinación adelante/atrás
                // Gamma: Inclinación izquierda/derecha
                setRotation({
                    alpha: e.alpha || 0,
                    beta: e.beta || 0,
                    gamma: e.gamma || 0
                });
            };

            const startVR = () => {
                if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                    DeviceOrientationEvent.requestPermission().then(state => {
                        if (state === 'granted') {
                            window.addEventListener('deviceorientation', handleMotion);
                            setActive(true);
                        }
                    });
                } else {
                    window.addEventListener('deviceorientation', handleMotion);
                    setActive(true);
                }
            };

            // Animación de vuelo constante
            useEffect(() => {
                if (!active) return;
                const interval = setInterval(() => {
                    setTravel(t => (t > 3000 ? 0 : t + 5));
                }, 16);
                return () => clearInterval(interval);
            }, [active]);

            if (!active) return (
                <div className="h-screen flex flex-col items-center justify-center bg-slate-900 text-white p-10 text-center">
                    <h1 className="text-4xl font-bold mb-6 italic text-cyan-400">NEON VR CITY</h1>
                    <div className="mb-10 text-gray-400">Coloca tu celular en el VR Box después de pulsar el botón</div>
                    <button 
                        className="bg-cyan-500 px-10 py-5 rounded-full text-2xl font-bold shadow-[0_0_20px_#22d3ee]"
                        onClick={startVR}
                    >
                        INICIAR VR
                    </button>
                </div>
            );

            const renderEye = (offset) => (
                <div className="eye">
                    <div className="scene" style={{
                        transform: `
                            translateZ(400px)
                            rotateX(${(rotation.beta - 70)}deg) 
                            rotateY(${(-rotation.alpha + offset)}deg)
                            rotateZ(${-rotation.gamma}deg)
                        `
                    }}>
                        {/* Cielo estrellado */}
                        {[...Array(50)].map((_, i) => (
                            <div key={i} className="star" style={{
                                transform: `translate3d(${Math.random()*2000-1000}px, ${Math.random()*1000-800}px, -1500px)`
                            }} />
                        ))}

                        {/* Edificios */}
                        {buildings.current.map(b => (
                            <div key={b.id} className="building" style={{
                                width: b.w, height: b.h,
                                transform: `translate3d(${b.x}px, ${800 - b.h}px, ${b.z + travel}px)`,
                                borderColor: b.color
                            }}>
                                <div className="neon-line" style={{ width: '100%', height: '2px', top: '20%', background: b.color }} />
                                <div className="neon-line" style={{ width: '100%', height: '2px', top: '50%', background: b.color }} />
                            </div>
                        ))}

                        {/* Suelo Futurista */}
                        <div style={{
                            position: 'absolute', width: '5000px', height: '5000px',
                            background: 'repeating-linear-gradient(rgba(0,210,255,0.1) 0 1px, transparent 1px 40px)',
                            transform: 'rotateX(90deg) translate3d(-2500px, 0, -800px)',
                            backgroundSize: '40px 40px'
                        }} />
                    </div>
                </div>
            );

            return (
                <div className="vr-container">
                    {renderEye(-1)} {/* Ojo izquierdo */}
                    {renderEye(1)}  {/* Ojo derecho (ligera diferencia de ángulo) */}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
