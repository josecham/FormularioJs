<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Roblox Mini-Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@700&display=swap');
        body { font-family: 'Fredoka', sans-serif; background: #00A2FF; margin: 0; overflow: hidden; touch-action: none; }
        
        /* Personaje tipo Roblox */
        .avatar {
            width: 40px; height: 40px;
            background: #FFD966;
            border: 3px solid #E69138;
            border-radius: 8px;
            position: absolute;
            transition: all 0.1s linear;
            box-shadow: 0 4px 0 #CC8400;
        }

        /* Moneda brillante */
        .coin {
            width: 30px; height: 30px;
            background: #F1C232;
            border: 3px solid #BF9000;
            border-radius: 50%;
            position: absolute;
            animation: spin 1s infinite;
        }

        @keyframes spin {
            0% { transform: scale(1) rotateY(0deg); }
            50% { transform: scale(1.2) rotateY(180deg); }
            100% { transform: scale(1) rotateY(360deg); }
        }

        .joystick-area {
            position: absolute; bottom: 40px; left: 40px;
            width: 120px; height: 120px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
        }

        .joystick-stick {
            width: 50px; height: 50px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .btn-roblox {
            background: #2ECC71;
            border-bottom: 6px solid #27AE60;
            color: white;
            padding: 20px 60px;
            border-radius: 20px;
            font-size: 32px;
            transition: 0.1s;
        }
        .btn-roblox:active { transform: translateY(4px); border-bottom-width: 2px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [view, setView] = useState('menu');
            const [score, setScore] = useState(0);
            const [player, setPlayer] = useState({ x: 150, y: 300 });
            const [coin, setCoin] = useState({ x: 100, y: 100 });
            
            const requestRef = useRef();
            const joystick = useRef({ x: 0, y: 0, active: false });

            // Mover la moneda a un lugar nuevo
            const spawnCoin = () => {
                setCoin({
                    x: Math.random() * (window.innerWidth - 50),
                    y: Math.random() * (window.innerHeight - 200) + 50
                });
            };

            // LÃ³gica del juego
            const update = () => {
                if (joystick.current.active) {
                    setPlayer(prev => {
                        const newX = prev.x + joystick.current.x * 5;
                        const newY = prev.y + joystick.current.y * 5;
                        
                        // Detectar si toca la moneda
                        const dist = Math.sqrt(Math.pow(newX - coin.x, 2) + Math.pow(newY - coin.y, 2));
                        if (dist < 40) {
                            setScore(s => s + 1);
                            spawnCoin();
                        }

                        return {
                            x: Math.max(0, Math.min(window.innerWidth - 40, newX)),
                            y: Math.max(50, Math.min(window.innerHeight - 150, newY))
                        };
                    });
                }
                requestRef.current = requestAnimationFrame(update);
            };

            useEffect(() => {
                requestRef.current = requestAnimationFrame(update);
                return () => cancelAnimationFrame(requestRef.current);
            }, [coin]);

            // Controles de Touch/Mouse
            const handleStart = (e) => { joystick.current.active = true; };
            const handleMove = (e) => {
                if (!joystick.current.active) return;
                const touch = e.touches ? e.touches[0] : e;
                const area = document.getElementById('joy-area').getBoundingClientRect();
                const centerX = area.left + 60;
                const centerY = area.top + 60;
                
                joystick.current.x = (touch.clientX - centerX) / 60;
                joystick.current.y = (touch.clientY - centerY) / 60;
            };
            const handleEnd = () => { 
                joystick.current.active = false; 
                joystick.current.x = 0; 
                joystick.current.y = 0; 
            };

            if (view === 'menu') {
                return (
                    <div className="h-screen flex flex-col items-center justify-center gap-10">
                        <h1 className="text-white text-6xl italic drop-shadow-lg">ROBLOX RUN</h1>
                        <button className="btn-roblox" onClick={() => setView('game')}>Â¡JUGAR!</button>
                    </div>
                );
            }

            return (
                <div className="h-screen w-full relative bg-[#82D677] overflow-hidden" 
                     onMouseMove={handleMove} onTouchMove={handleMove}
                     onMouseUp={handleEnd} onTouchEnd={handleEnd}>
                    
                    {/* Puntaje */}
                    <div className="absolute top-5 w-full text-center">
                        <div className="inline-block bg-yellow-400 border-4 border-white px-8 py-2 rounded-full shadow-xl">
                            <span className="text-white text-3xl font-bold">ðŸ’° {score}</span>
                        </div>
                    </div>

                    {/* Moneda */}
                    <div className="coin" style={{ left: coin.x, top: coin.y }}></div>

                    {/* Jugador */}
                    <div className="avatar" style={{ left: player.x, top: player.y }}>
                        <div className="flex justify-around mt-2 px-1">
                            <div className="w-2 h-2 bg-black rounded-full"></div>
                            <div className="w-2 h-2 bg-black rounded-full"></div>
                        </div>
                        <div className="w-4 h-1 bg-black mx-auto mt-2 rounded-full"></div>
                    </div>

                    {/* Controles */}
                    <div id="joy-area" className="joystick-area" onMouseDown={handleStart} onTouchStart={handleStart}>
                        <div className="joystick-stick" style={{ 
                            transform: `translate(${joystick.current.x * 30}px, ${joystick.current.y * 30}px)` 
                        }}></div>
                    </div>

                    <button className="absolute top-5 left-5 bg-red-500 text-white p-3 rounded-xl border-b-4 border-red-800"
                            onClick={() => setView('menu')}>SALIR</button>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
