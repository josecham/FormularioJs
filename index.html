<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Blox Universe 3D</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@700&display=swap');
        body { font-family: 'Fredoka', sans-serif; background: #00A2FF; margin: 0; overflow: hidden; touch-action: none; }
        
        /* Efecto de Universo / Perspectiva */
        .world {
            perspective: 1000px;
            width: 100vw; height: 100vh;
            display: flex; align-items: center; justify-content: center;
        }

        .floor {
            width: 2000px; height: 2000px;
            background-color: #7cfc00;
            background-image: radial-gradient(#6edb00 2px, transparent 2px);
            background-size: 40px 40px;
            transform: rotateX(60deg) translateY(-200px);
            position: absolute;
            transition: transform 0.1s linear;
        }

        /* Personaje 3D (Cubo) */
        .cube-player {
            position: absolute;
            width: 50px; height: 80px;
            transform-style: preserve-3d;
            transition: all 0.1s linear;
        }
        .side {
            position: absolute; width: 100%; height: 100%;
            border: 2px solid rgba(0,0,0,0.1);
        }
        .front  { background: #FFD966; transform: translateZ(25px); }
        .back   { background: #E69138; transform: rotateY(180deg) translateZ(25px); }
        .right  { background: #F1C232; width: 50px; transform: rotateY(90deg) translateZ(25px); }
        .left   { background: #F1C232; width: 50px; transform: rotateY(-90deg) translateZ(25px); }
        .top    { background: #FFD966; height: 50px; transform: rotateX(90deg) translateZ(25px); }

        /* Moneda 3D */
        .item-3d {
            position: absolute;
            width: 30px; height: 30px;
            background: #FFD700;
            border-radius: 50%;
            border: 4px solid #B8860B;
            transform: rotateX(60deg);
            animation: float 1s infinite alternate;
        }

        @keyframes float { from { margin-top: 0; } to { margin-top: -20px; } }

        .ui { position: absolute; top: 0; left: 0; width: 100%; pointer-events: none; }
        .joy-area { position: absolute; bottom: 50px; left: 50px; width: 150px; height: 150px; background: rgba(255,255,255,0.2); border-radius: 50%; pointer-events: auto; }
        .stick { width: 60px; height: 60px; background: white; border-radius: 50%; position: absolute; top: 45px; left: 45px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [view, setView] = useState('menu');
            const [coins, setCoins] = useState(0);
            const [pos, setPos] = useState({ x: 0, y: 0 });
            const [coinPos, setCoinPos] = useState({ x: 100, y: -200 });
            
            const joystick = useRef({ x: 0, y: 0, active: false });
            const requestRef = useRef();

            const update = () => {
                if (joystick.current.active) {
                    setPos(prev => {
                        const newX = prev.x - joystick.current.x * 10;
                        const newY = prev.y - joystick.current.y * 10;

                        // Detección de colisión con la moneda
                        const dx = newX + coinPos.x;
                        const dy = newY + coinPos.y;
                        if (Math.sqrt(dx*dx + dy*dy) < 50) {
                            setCoins(c => c + 1);
                            setCoinPos({ x: Math.random() * 600 - 300, y: Math.random() * 600 - 300 });
                        }

                        return { x: newX, y: newY };
                    });
                }
                requestRef.current = requestAnimationFrame(update);
            };

            useEffect(() => {
                requestRef.current = requestAnimationFrame(update);
                return () => cancelAnimationFrame(requestRef.current);
            }, [coinPos]);

            const handleStart = () => joystick.current.active = true;
            const handleEnd = () => { joystick.current.active = false; joystick.current.x = 0; joystick.current.y = 0; };
            const handleMove = (e) => {
                if (!joystick.current.active) return;
                const touch = e.touches ? e.touches[0] : e;
                const area = document.getElementById('joy').getBoundingClientRect();
                const centerX = area.left + 75;
                const centerY = area.top + 75;
                joystick.current.x = (touch.clientX - centerX) / 75;
                joystick.current.y = (touch.clientY - centerY) / 75;
            };

            if (view === 'menu') {
                return (
                    <div className="h-screen flex flex-col items-center justify-center bg-sky-500">
                        <h1 className="text-white text-6xl mb-10 drop-shadow-2xl italic uppercase">Blox Adventure</h1>
                        <button className="bg-green-500 text-white text-4xl px-16 py-8 rounded-3xl border-b-8 border-green-700 active:translate-y-2 active:border-b-2 transition-all"
                                onClick={() => setView('game')}>¡ENTRAR!</button>
                    </div>
                );
            }

            return (
                <div className="world" onTouchMove={handleMove} onMouseMove={handleMove} onMouseUp={handleEnd} onTouchEnd={handleEnd}>
                    {/* El Suelo que se mueve */}
                    <div className="floor" style={{ transform: `rotateX(60deg) translate3d(${pos.x}px, ${pos.y}px, 0)` }}>
                        {/* Moneda en el suelo */}
                        <div className="item-3d" style={{ left: 1000 + coinPos.x, top: 1000 + coinPos.y }}></div>
                    </div>

                    {/* El Jugador (Cubo central) */}
                    <div className="cube-player" style={{ transform: `rotateY(${joystick.current.x * 45}deg)` }}>
                        <div className="side front flex flex-col items-center justify-center">
                            <div className="flex gap-4 mb-2"><div className="w-2 h-2 bg-black rounded-full"></div><div className="w-2 h-2 bg-black rounded-full"></div></div>
                            <div className="w-6 h-2 bg-black rounded-full"></div>
                        </div>
                        <div className="side back"></div>
                        <div className="side right"></div>
                        <div className="side left"></div>
                        <div className="side top"></div>
                    </div>

                    {/* UI Overlay */}
                    <div className="ui h-full flex flex-col justify-between p-6">
                        <div className="bg-yellow-400 border-4 border-white self-center px-10 py-2 rounded-full shadow-2xl pointer-events-auto">
                            <span className="text-white text-4xl font-bold tracking-tighter">⭐ {coins}</span>
                        </div>
                        <div id="joy" className="joy-area" onMouseDown={handleStart} onTouchStart={handleStart}>
                            <div className="stick" style={{ transform: `translate(${joystick.current.x * 40}px, ${joystick.current.y * 40}px)` }}></div>
                        </div>
                    </div>
                    <button className="absolute top-5 left-5 bg-red-500 text-white p-3 rounded-xl border-b-4 border-red-800 pointer-events-auto" onClick={() => setView('menu')}>SALIR</button>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
