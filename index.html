<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Futuristic VR Walk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; touch-action: none; font-family: sans-serif; }
        
        .vr-container { display: flex; width: 100vw; height: 100vh; }
        .eye { flex: 1; height: 100%; overflow: hidden; position: relative; perspective: 800px; }

        .scene {
            position: absolute; width: 100%; height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.05s linear; /* Suaviza el movimiento */
        }

        .building {
            position: absolute;
            background: linear-gradient(to top, #0f0c29, #302b63, #24243e);
            border: 1px solid #6a0572;
            box-shadow: 0 0 15px #bb00ff55;
            transform-style: preserve-3d;
        }
        .neon-stripe { position: absolute; background: #8d021f; box-shadow: 0 0 8px #d60032; }
        
        /* Suelo de la ciudad */
        .city-ground {
            position: absolute; width: 5000px; height: 5000px;
            background: repeating-linear-gradient(rgba(106,5,114,0.3) 0 2px, transparent 2px 50px),
                        repeating-linear-gradient(90deg, rgba(106,5,114,0.3) 0 2px, transparent 2px 50px);
            background-size: 50px 50px;
            transform: rotateX(90deg) translate3d(-2500px, 0, -50px); /* Ajustado para que veas el suelo bajo tus pies */
            filter: brightness(0.7);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [active, setActive] = useState(false);
            const [rotation, setRotation] = useState({ alpha: 0, beta: 0, gamma: 0 });
            const [positionZ, setPositionZ] = useState(0); // Tu posición en el eje Z (adelante/atrás)
            const [positionX, setPositionX] = useState(0); // Tu posición en el eje X (izquierda/derecha)
            
            const buildings = useRef([...Array(60)].map((_, i) => ({
                id: i,
                x: Math.random() * 3000 - 1500, // Más dispersos
                z: Math.random() * -6000 + 1000, // Más profundidad
                w: 80 + Math.random() * 150,
                h: 300 + Math.random() * 700,
                color: i % 3 === 0 ? '#ff00ff' : '#00ffff' // Más colores neón
            })));

            const handleMotion = (e) => {
                setRotation({
                    alpha: e.alpha || 0,
                    beta: e.beta || 0,
                    gamma: e.gamma || 0
                });
            };

            const startVR = () => {
                if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                    DeviceOrientationEvent.requestPermission().then(state => {
                        if (state === 'granted') {
                            window.addEventListener('deviceorientation', handleMotion);
                            setActive(true);
                        }
                    }).catch(error => alert("Error al conceder permisos: " + error));
                } else {
                    window.addEventListener('deviceorientation', handleMotion);
                    setActive(true);
                }
            };

            // Bucle de movimiento simulado por inclinación de cabeza
            useEffect(() => {
                if (!active) return;
                const interval = setInterval(() => {
                    // Si miras hacia abajo (beta > 80), avanza
                    // Si miras hacia arriba (beta < 40), retrocede
                    const forwardSpeed = Math.max(0, (rotation.beta - 70) / 10); // Más sensible
                    const backwardSpeed = Math.max(0, (30 - rotation.beta) / 10);
                    
                    setPositionZ(prevZ => prevZ + (forwardSpeed - backwardSpeed) * 10); // Velocidad de "caminar"
                    
                    // Si inclinas la cabeza hacia los lados (gamma)
                    const sideSpeed = rotation.gamma / 50; // Ajusta la velocidad lateral
                    setPositionX(prevX => prevX + sideSpeed * 10);

                }, 50); // Más frecuente para mayor fluidez
                return () => clearInterval(interval);
            }, [active, rotation]); // Depende de la rotación para reaccionar al instante

            if (!active) return (
                <div className="h-screen flex flex-col items-center justify-center bg-gray-900 text-white p-10 text-center">
                    <h1 className="text-4xl font-bold mb-6 italic text-fuchsia-400">CIUDAD NEÓN A PIE</h1>
                    <div className="mb-10 text-gray-400">
                        Inicia VR, coloca el celular en el VR Box. <br/>
                        Mira hacia abajo para caminar, mira al frente para detenerte, mira arriba para retroceder.
                    </div>
                    <button 
                        className="bg-fuchsia-600 px-10 py-5 rounded-full text-2xl font-bold shadow-[0_0_20px_#d946ef]"
                        onClick={startVR}
                    >
                        INICIAR VR Y CAMINAR
                    </button>
                </div>
            );

            const renderEye = (offset) => (
                <div className="eye">
                    <div className="scene" style={{
                        transform: `
                            translate3d(${positionX + offset * 10}px, 0px, ${positionZ}px) /* Tu posición */
                            rotateX(${(-rotation.beta + 90)}deg) /* Ajuste para ver el suelo naturalmente */
                            rotateY(${-rotation.alpha}deg)
                            rotateZ(${rotation.gamma}deg)
                        `
                    }}>
                        {/* Edificios */}
                        {buildings.current.map(b => (
                            <div key={b.id} className="building" style={{
                                width: b.w, height: b.h,
                                transform: `translate3d(${b.x}px, ${150 - b.h}px, ${b.z}px)`, /* Ajusta Y para que estén en el suelo */
                                borderColor: b.color
                            }}>
                                <div className="neon-stripe" style={{ width: '100%', height: '4px', top: '20%', background: b.color }} />
                                <div className="neon-stripe" style={{ width: '100%', height: '4px', top: '50%', background: b.color }} />
                                <div className="neon-stripe" style={{ width: '100%', height: '4px', top: '80%', background: b.color }} />
                            </div>
                        ))}

                        {/* Suelo de la Ciudad */}
                        <div className="city-ground" />
                    </div>
                </div>
            );

            return (
                <div className="vr-container">
                    {renderEye(-10)} {/* Ojo izquierdo, ajustado ligeramente */}
                    {renderEye(10)}  {/* Ojo derecho, ajustado ligeramente */}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
